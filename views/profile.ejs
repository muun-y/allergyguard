<%- include("templates/header") %>
    <%- include("templates/navbar") %>

        <div class="p-6 max-w-4xl mx-auto space-y-6">
            <header class="text-center space-y-2">
                <div class="flex justify-center">
                    <% if (user.profileImg) { %>
                        <img src="<%= user.profileImg %>" alt="Profile Picture"
                            class="w-24 h-24 rounded-full border shadow">
                        <% } else { %>
                            <div
                                class="w-24 h-24 flex items-center justify-center rounded-full bg-gray-200 text-gray-500 text-3xl">
                                <%= user.username ? user.username[0].toUpperCase() : "U" %>
                            </div>
                            <% } %>
                </div>
                <h1 class="text-2xl font-bold">
                    <%= user.username || "No Username" %>
                </h1>
                <p class="text-gray-600">
                    <%= user.email %>
                </p>
                <button class="mt-2 px-4 py-2 bg-black text-white rounded hover:bg-gray-800">
                    Edit Profile
                </button>
            </header>

            <!-- 요약 카드 -->
            <div class="grid grid-cols-2 gap-4">
                <div class="p-4 border rounded-lg bg-white shadow text-center">
                    <p class="text-sm text-gray-500">My Allergies</p>
                    <p class="text-xl font-semibold">
                        <%= allergies ? allergies.length : 0 %>
                    </p>
                </div>
                <div class="p-4 border rounded-lg bg-white shadow text-center">
                    <p class="text-sm text-gray-500">Scan History</p>
                    <p class="text-xl font-semibold">
                        <%= historyCount || 0 %>
                    </p>
                </div>
            </div>

            <!-- 최근 알러지 -->
            <section>
                <h2 class="text-lg font-semibold mb-2">My Allergies</h2>
                <ul class="flex flex-wrap gap-2">
                    <% if (!allergies || allergies.length===0) { %>
                        <li class="text-sm text-gray-500">No allergies added yet.</li>
                        <% } else { %>
                            <% allergies.forEach(a=> { %>
                                <li class="px-3 py-1 rounded-full bg-gray-100 border text-sm">
                                    <%= a.allergen %>
                                </li>
                                <% }) %>
                                    <% } %>
                </ul>
            </section>

            <!-- 최근 스캔 -->
            <section>
                <h2 class="text-lg font-semibold mb-2">Recent Scans</h2>
                <ul class="divide-y border rounded bg-white">
                    <% if (!recentScans || recentScans.length===0) { %>
                        <li class="p-3 text-sm text-gray-500">No scans yet.</li>
                        <% } else { %>
                            <% recentScans.forEach(scan=> { %>
                                <li class="p-3 flex justify-between">
                                    <span class="text-sm text-gray-700">
                                        <%= new Date(scan.createdAt.toDate()).toLocaleDateString() %> —
                                            <% if (scan.matched && scan.matched.length> 0) { %>
                                                ⚠️ <%= scan.matched.join(", ") %>
                            <% } else { %>
                                ✅ No allergens
                            <% } %>
                        </span>
                        <a href=" /scan-history/<%=scan.id %>"
                                                    class="text-xs text-blue-600 hover:underline">details</a>
                                </li>
                                <% }) %>
                                    <% } %>
                </ul>
            </section>
        </div>

        <%- include("templates/footer") %>